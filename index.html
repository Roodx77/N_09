<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>09 – رحلة الانفعالات</title>
<style>
body{
  margin:0;
  background:#0f0f0f;
  color:#eaeaea;
  font-family:Arial;
  text-align:center;
}
#ui{
  position:absolute;
  top:20px;
  width:100%;
  pointer-events:none;
}
h1{color:#4fd1c5;margin:0}
p{margin:5px}
canvas{
  display:block;
  margin:80px auto 20px;
  background:#161616;
  border-radius:16px;
}
.btn{
  background:#4fd1c5;
  color:#000;
  border:none;
  padding:12px 24px;
  border-radius:30px;
  cursor:pointer;
  margin-top:10px;
}
</style>
</head>

<body>

<div id="ui">
  <h1 id="title">09</h1>
  <p id="subtitle">رحلة داخل الانفعالات</p>
</div>

<canvas id="game" width="360" height="360"></canvas>
<button class="btn" onclick="startGame()">ابدأ الرحلة</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let stage = 0;
let mode = "idle";
let running = false;

const stages = [
  {name:"الخوف", mode:"maze"},
  {name:"القلق", mode:"snake"},
  {name:"الغضب", mode:"speed"},
  {name:"الحزن", mode:"blocks"},
  {name:"التعلق", mode:"climb"},
  {name:"الفراغ", mode:"still"}
];

let player = {x:180,y:180,size:10,vx:0,vy:0};
let snake = [{x:180,y:180}];
let food = {x:100,y:100};

function startGame(){
  stage = 0;
  loadStage();
  running = true;
  requestAnimationFrame(loop);
}

function loadStage(){
  const s = stages[stage];
  document.getElementById("title").innerText = s.name;
  document.getElementById("subtitle").innerText = "لاحظ… ولا تستعجل";
  mode = s.mode;
  reset();
}

function reset(){
  player = {x:180,y:180,size:10,vx:0,vy:0};
  snake = [{x:180,y:180}];
  food = {
    x:Math.random()*320+20,
    y:Math.random()*320+20
  };
}

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp"){player.vy=-1;player.vx=0;}
  if(e.key==="ArrowDown"){player.vy=1;player.vx=0;}
  if(e.key==="ArrowLeft"){player.vx=-1;player.vy=0;}
  if(e.key==="ArrowRight"){player.vx=1;player.vy=0;}
});

function loop(){
  if(!running) return;
  ctx.clearRect(0,0,360,360);

  if(mode==="snake") updateSnake();
  else if(mode==="speed") updateSpeed();
  else if(mode==="blocks") updateBlocks();
  else if(mode==="climb") updateClimb();
  else if(mode==="still") updateStill();
  else updateMaze();

  drawPlayer();
  requestAnimationFrame(loop);
}

function drawPlayer(){
  ctx.fillStyle="#4fd1c5";
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.size,0,Math.PI*2);
  ctx.fill();
}

/* ===== أنماط اللعب ===== */

function updateMaze(){
  player.x+=player.vx;
  player.y+=player.vy;
}

function updateSnake(){
  player.x+=player.vx*2;
  player.y+=player.vy*2;
  ctx.fillStyle="#888";
  ctx.fillRect(food.x,food.y,8,8);
}

function updateSpeed(){
  player.x+=player.vx*4;
  player.y+=player.vy*4;
}

function updateBlocks(){
  player.x+=player.vx;
  player.y+=player.vy;
  ctx.fillStyle="#333";
  ctx.fillRect(140,140,80,80);
}

function updateClimb(){
  player.y+=player.vy;
}

function updateStill(){
  // لا حركة – فقط وجود
}

/* ===== انتقال تلقائي ===== */
setInterval(()=>{
  if(!running) return;
  stage++;
  if(stage>=stages.length){
    running=false;
    document.getElementById("title").innerText="انتهت الرحلة";
    document.getElementById("subtitle").innerText="الوعي هو الفوز";
  } else {
    loadStage();
  }
},20000);
</script>

</body>
</html>
