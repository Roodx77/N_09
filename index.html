<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>09 – رحلة الانفعالات (شخصين)</title>

<style>
body{
  margin:0;
  background:#0f0f0f;
  color:#eaeaea;
  font-family:Arial;
  text-align:center;
}
h1{color:#4fd1c5;margin:10px}
p{margin:4px;font-size:14px}
canvas{
  background:#161616;
  display:block;
  margin:10px auto;
  border-radius:14px;
}
#hint{opacity:.7}
</style>
</head>

<body>

<h1 id="stageTitle">09</h1>
<p id="hint">لاعب 1: الأسهم ⬅⬆⬇➡ — لاعب 2: WASD</p>
<canvas id="game" width="360" height="360"></canvas>
<p id="progress"></p>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const title = document.getElementById("stageTitle");
const progress = document.getElementById("progress");

const stages = [
 "الخوف","الغضب","الحزن","القلق","العار","الذنب","الغيرة",
 "الحسد","الإحباط","الوحدة","الخجل","الكبرياء","الكره",
 "اليأس","الندم","الارتباك","الاشمئزاز","التعلق","الفراغ"
];

let stageIndex = 0;
let time = 0;

const p1 = {x:180,y:180,vx:0,vy:0,color:"#4fd1c5"};
const p2 = {x:100,y:100,vx:0,vy:0,color:"#888"};

let speedFactor = 1;

function loadStage(){
  title.textContent = stages[stageIndex];
  progress.textContent = `${stageIndex+1} / 19`;
  time = 0;

  p1.x=180; p1.y=180;
  p2.x=100; p2.y=100;

  // تغيير الإحساس حسب المرحلة
  if(stageIndex < 6) speedFactor = 1;
  else if(stageIndex < 13) speedFactor = 2;
  else speedFactor = 0.7;
}

document.addEventListener("keydown",e=>{
  // لاعب 1
  if(e.key==="ArrowUp"){p1.vy=-1;p1.vx=0;}
  if(e.key==="ArrowDown"){p1.vy=1;p1.vx=0;}
  if(e.key==="ArrowLeft"){p1.vx=-1;p1.vy=0;}
  if(e.key==="ArrowRight"){p1.vx=1;p1.vy=0;}

  // لاعب 2 (يؤثر على الجو)
  if(e.key==="w"){p2.vy=-1;}
  if(e.key==="s"){p2.vy=1;}
  if(e.key==="a"){p2.vx=-1;}
  if(e.key==="d"){p2.vx=1;}
});

function update(){
  time++;

  // لاعب 2 يغيّر الإيقاع
  speedFactor = 1 + Math.abs(p2.vx+p2.vy)*0.3;

  p1.x += p1.vx * speedFactor;
  p1.y += p1.vy * speedFactor;

  // حدود
  p1.x=Math.max(10,Math.min(350,p1.x));
  p1.y=Math.max(10,Math.min(350,p1.y));

  // انتقال تلقائي كل 20 ثانية
  if(time > 1200){
    stageIndex++;
    if(stageIndex>=stages.length){
      title.textContent="انتهت الرحلة";
      progress.textContent="الوعي بينكما";
      return;
    }
    loadStage();
  }
}

function draw(){
  ctx.clearRect(0,0,360,360);

  // تأثير بصري خفيف
  ctx.fillStyle="rgba(255,255,255,0.03)";
  ctx.fillRect(0,0,360,360);

  // لاعب 1
  ctx.fillStyle=p1.color;
  ctx.beginPath();
  ctx.arc(p1.x,p1.y,8,0,Math.PI*2);
  ctx.fill();

  // لاعب 2 (ظل/تأثير)
  ctx.strokeStyle=p2.color;
  ctx.beginPath();
  ctx.arc(p2.x,p2.y,14,0,Math.PI*2);
  ctx.stroke();
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

loadStage();
loop();
</script>

</body>
</html>
